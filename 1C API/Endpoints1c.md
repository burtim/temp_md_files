# 1C API
***
## Процедуры с автомобилями

### Добавить автомобиль и привязать к владельцу.
POST (api/1c/auto)
```json lines
//принимает
{
  "clientId" : 0, //Идентификатор клиента
  "mark": "string", //*** Марка авто (производитель)
  "model": "string", //*** Модель авто
  "year": 0, //Год производства
  "vin": "string", //*** VIN
  "registrationNumber": "string", //регистрационный номер
  "mileAge": 0, //Пробег авто
}
//отдает созданный объект
{
  "Id" : 0, //система выдает уникальный ID
  "mark": "string", //*** Марка авто (производитель)
  "model": "string", //*** Модель авто
  "year": 0, //Год производства
  "vin": "string", //*** VIN
  "registrationNumber": "string", //регистрационный номер
  "mileAge" : 0, //необязательное поле, может не быть информации о пробеге
}

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

### Получить автомобиль
GET (api/1c/auto/{autoId})
> Может нужно получить не автомобиль, автомобили клиента?
```json
//отдает (не все параметры могут прийти! Например, нет отчества или клиент не заполнил имя и фамилию)
{
  "Id" : 0, //система выдает уникальный ID
  "mark": "string", //*** Марка авто (производитель)
  "model": "string", //*** Модель авто
  "year": 0, //Год производства
  "vin": "string", //*** VIN
  "registrationNumber": "string", //регистрационный номер
  "mileAge" : 0 //необязательное поле, может не быть информации о пробеге
}

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

### Получить автомобили клиента
GET (api/1c/auto?clientId={CLIENT_ID})
```json
//Удачная операция отдает код 200 и результат (не все параметры могут прийти! Например, нет отчества или клиент не заполнил имя и фамилию)
  [
    {
      "Id" : 0, //система выдает уникальный ID
      "mark": "string", //*** Марка авто (производитель)
      "model": "string", //*** Модель авто
      "year": 0, //Год производства
      "vin": "string", //*** VIN
      "registrationNumber": "string", //регистрационный номер
      "mileAge" : 0 //необязательное поле, может не быть информации о пробеге
    },
    {
      "Id" : 0, //система выдает уникальный ID
      "mark": "string", //*** Марка авто (производитель)
      "model": "string", //*** Модель авто
      "year": 0, //Год производства
      "vin": "string", //*** VIN
      "registrationNumber": "string", //регистрационный номер
      "mileAge" : 0 //необязательное поле, может не быть информации о пробеге
    }
  ]



//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```


### Изменить характеристики авто.
PUT (api/1c/auto/{autoId})
> Поля необязательны, следует отправлять только изменяемые поля
```json
//принимает
{
  "mark": "string", //Марка авто (производитель)
  "model": "string", //Модель авто
  "year": 0, //Год производства
  "vin": "string", //VIN
  "registrationNumber": "string", //Регистрационный номер
  "mileAge" : 0 //пробег
}
 
//Удачная операция отдает код 200 и результат
{
  "Id" : 0, //система выдает уникальный ID
  "mark": "string", //*** Марка авто (производитель)
  "model": "string", //*** Модель авто
  "year": 0, //Год производства
  "vin": "string", //*** VIN
  "registrationNumber": "string", //регистрационный номер
  "mileAge" : 0 //необязательное поле, может не быть информации о пробеге
}
//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

### Удалить авто
PUT (api/1c/auto/{autoId})
```json
//Удачная операция отдает код 200

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

### Передать авто другому клиенту
PUT (api/1c/auto/transfer?autoId={AUTO_ID}&clientId={CLIENT_ID})
```json
//Удачная операция отдает код 200

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

## Процедуры для работы с владельцами (КЛИЕНТАМИ)

### Добавление владельца (Клиента)
> Пользователь мобильного приложения (клиент) уже автоматически является владельцем, его добавлять не нужно

### Удаление владельца (Клиента)
> Нельзя сделать этот метод, так как придется удалить аккаунт клиента.


### Получить владельца (клиента)
GET (api/1c/client/{clientId})
```json
//Отдает 200 и
  {
    "clientId": 2, 
    "email": "ivan@gmail.com",
    "phoneNumber": "89881234567",
    "firstName": "Иван",
    "lastName": "Иванов",
    "patronymic": "Иванович"
  }

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

## Процедуры для работы с заказ-нарядами
> В пилотной версии упрощенная система заказ-нарядов - (Заявки на ремонты)  
> Заказ-наряды из 1С будут отправляться в AutoBonus, чтобы сервис AutoBonus имел информацию о произведенных ремонтах.  
> Отправка заказ-наряда подразумевает, что ремонт уже произведет, поэтому статус ремонта будет (CLOSED) для заказ-нарядов.
### Добавить заказ-наряд (заявку на ремонт)
POST (api/1c/repair)
```json
//принимает
  {
    "clientId" : 0, //УИН клиента
    "inn" : 0, //ИНН организации
    "vin" : "string", //Авто с VIN должно принадлежать клиенту
    "createdTime" : "2021-10-22T06:40:41", //Дата/время документа
    "documentId" : 0, //Номер документа
    "totalSum" : 0, //Сумма документа
    "workSum" : 0, //Сумма работ
    "goodSum" : 0, //Сумма товаров
    "comment" : "string", //комментарий к заказ-наряду
    "mileAge" : 0 //пробег
  }
//Отдает созданную заявку на ремонт (заказ-наряд) и код 200
{
  "id" : 0, //Идентификатор заявки (заказ-наряда) уникальный в сервисе.
  "createdTime" : "2021-10-22T06:40:41", //время создания заявки (заказ-наряда)
  "description" : "string", //Описание проблемы
  "status" : "string",
  "documentId" : 0, //Номер документа
  "totalSum" : 0, //Сумма документа
  "workSum" : 0, //Сумма работ
  "goodSum" : 0, //Сумма товаров
  "comment" : "string", //комментарий к заказ-наряду
  "mileAge" : 0 //пробег
  "auto" : {
    "Id" : 0, //система выдает уникальный ID
    "mark": "string", //*** Марка авто (производитель)
    "model": "string", //*** Модель авто
    "year": 0, //Год производства
    "vin": "string", //*** VIN
    "registrationNumber": "string", //регистрационный номер
    "mileAge" : 0, //необязательное поле, может не быть информации о пробеге
  },
  "client" : {
    "Id" : 0,
    "firstName" : "string",
    "lastName" : "string",
    "patronymic" : "string",
    "phoneNumber" : "string",
    "email" : "string",
  },
}
//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

### Изменить заказ-наряд (изменить сумму работ, товаров, дату, статус, пробег и т.д.)
PUT (api/1c/repair/{repairId})
```json
//!!!Отсылать только изменяемые параметры!!!
//принимает, 
{
  "createdTime" : "2021-10-22T06:40:41", //время создания заявки (заказ-наряда)
  "description" : "string", //Описание проблемы
  "status" : "string", //возможные значения [new/record/work/canceled/closed]
  "autoId" : 0,
  "clientId" : 0,
  "documentId" : 0, //Номер документа
  "totalSum" : 0, //Сумма документа
  "workSum" : 0, //Сумма работ
  "goodSum" : 0, //Сумма товаров
  "comment" : "string", //комментарий к заказ-наряду
  "mileAge" : 0 //пробег
}
//Отдает измененный объект и код 200
{
  "id" : 0, //Идентификатор заявки (заказ-наряда) уникальный в сервисе.
  "createdTime" : "2021-10-22T06:40:41", //время создания заявки (заказ-наряда)
  "description" : "string", //Описание проблемы
  "status" : "string",
  "documentId" : 0, //Номер документа
  "totalSum" : 0, //Сумма документа
  "workSum" : 0, //Сумма работ
  "goodSum" : 0, //Сумма товаров
  "comment" : "string", //комментарий к заказ-наряду
  "mileAge" : 0 //пробег
  "auto" : {
    "Id" : 0, //система выдает уникальный ID
    "mark": "string", //*** Марка авто (производитель)
    "model": "string", //*** Модель авто
    "year": 0, //Год производства
    "vin": "string", //*** VIN
    "registrationNumber": "string", //регистрационный номер
    "mileAge" : 0, //необязательное поле, может не быть информации о пробеге
  },
  "client" : {
    "Id" : 0,
    "firstName" : "string",
    "lastName" : "string",
    "patronymic" : "string",
    "phoneNumber" : "string",
    "email" : "string",
  },
}
//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

### Удалить заказ-наряд
DELETE (api/1c/repair/{repairId})
```json
//Удачная операция отдает код 200

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```


## Авторизация для работы с сервисом  
> Прежде чем отправлять запросы сервису, необходимо авторизоваться.  
> Авторизация основана на JWT токенах.  
> Jwt token истекает через 24 часа. RefreshToken истекает через 168 часов.
> Для осуществление запросов процедур необходимо добавить заголовок авторизации (Bearer [token])
> Ниже описаны методы авторизации.

### Авторизация пользователя
POST (/api/account/login)
```json
//На вход принимает
{
  "email": "string",
  "password": "string"
}

//отдает
{
  "userId": 0,
  "userName": "string",
  "token" : "string",
  "refreshToken": "string"
}

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

### Выход пользователя
POST (api/account/logout)
```json
//Удачная операция отдает код 200

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

### Обновить токены (когда jwt истек, а refresh еще нет, чтобы заново не авторизовываться)
POST (api/account/refresh-tokens)
```json
//На вход принимает
{
  "refreshToken": "string"
}

//отдает
{
  "refreshToken": "string",
  "jwtToken": "string"
}

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```
