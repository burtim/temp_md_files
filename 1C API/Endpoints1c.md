# 1C API
***
## Процедуры с автомобилями

### Добавить автомобиль и привязать к владельцу.
POST (api/1c/auto)
```json lines
//принимает
{
  "clientId" : 0, //Идентификатор клиента
  "mark": "string", //*** Марка авто (производитель)
  "model": "string", //*** Модель авто
  "year": 0, //Год производства
  "vin": "string", //*** VIN
  "registrationNumber": "string", //регистрационный номер
  "mileAge": 0, //Пробег авто
}
//отдает созданный объект
{
  "Id" : 0, //система выдает уникальный ID
  "mark": "string", //*** Марка авто (производитель)
  "model": "string", //*** Модель авто
  "year": 0, //Год производства
  "vin": "string", //*** VIN
  "registrationNumber": "string", //регистрационный номер
  "mileAge" : 0, //необязательное поле, может не быть информации о пробеге
}

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

### Получить автомобили клиента
GET (api/1c/auto?clientId={CLIENT_ID}&autoId={AUTO_ID})
```json
//Удачная операция отдает код 200 и результат (не все параметры могут прийти! Например, нет отчества или клиент не заполнил имя и фамилию)
  [
    {
      "Id" : 0, //система выдает уникальный ID
      "mark": "string", //*** Марка авто (производитель)
      "model": "string", //*** Модель авто
      "year": 0, //Год производства
      "vin": "string", //*** VIN
      "registrationNumber": "string", //регистрационный номер
      "mileAge" : 0 //необязательное поле, может не быть информации о пробеге
    },
    {
      "Id" : 0, //система выдает уникальный ID
      "mark": "string", //*** Марка авто (производитель)
      "model": "string", //*** Модель авто
      "year": 0, //Год производства
      "vin": "string", //*** VIN
      "registrationNumber": "string", //регистрационный номер
      "mileAge" : 0 //необязательное поле, может не быть информации о пробеге
    }
  ]

//Если указан параметр AUTO_ID то отдает
//отдает (не все параметры могут прийти! Например, нет отчества или клиент не заполнил имя и фамилию)
{
  "Id" : 0, //система выдает уникальный ID
  "mark": "string", //*** Марка авто (производитель)
  "model": "string", //*** Модель авто
  "year": 0, //Год производства
  "vin": "string", //*** VIN
  "registrationNumber": "string", //регистрационный номер
  "mileAge" : 0 //необязательное поле, может не быть информации о пробеге
}

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```


### Изменить характеристики авто.
PUT (api/1c/auto/{autoId})
> Поля необязательны, следует отправлять только изменяемые поля
```json
//принимает
{
  "mark": "string", //Марка авто (производитель)
  "model": "string", //Модель авто
  "year": 0, //Год производства
  "vin": "string", //VIN
  "registrationNumber": "string", //Регистрационный номер
  "mileAge" : 0 //пробег
}
 
//Удачная операция отдает код 200 и результат
{
  "Id" : 0, //система выдает уникальный ID
  "mark": "string", //*** Марка авто (производитель)
  "model": "string", //*** Модель авто
  "year": 0, //Год производства
  "vin": "string", //*** VIN
  "registrationNumber": "string", //регистрационный номер
  "mileAge" : 0 //необязательное поле, может не быть информации о пробеге
}
//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

### Удалить авто
PUT (api/1c/auto/{autoId})
```json
//Удачная операция отдает код 200

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

### Передать авто другому клиенту
PUT (api/1c/auto/transfer?autoId={AUTO_ID}&clientId={CLIENT_ID})
```json
//Удачная операция отдает код 200

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

## Процедуры для работы с владельцами (КЛИЕНТАМИ)

### Добавление владельца (Клиента)
> Пользователь мобильного приложения (клиент) уже автоматически является владельцем, его добавлять не нужно

### Удаление владельца (Клиента)
> Нельзя сделать этот метод, так как придется удалить аккаунт клиента.


### Получить владельца (клиента)
GET (api/1c/client/{clientId})
```json
//Отдает 200 и
  {
    "clientId": 2, 
    "email": "ivan@gmail.com",
    "phoneNumber": "89881234567",
    "firstName": "Иван",
    "lastName": "Иванов",
    "patronymic": "Иванович"
  }

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

## Процедуры для работы с заказ-нарядами

### Отправить заказ-наряд (добавить/изменить) 
POST (api/1c/repair/send)  
//Если существует заказ-наряд, у которого DocumentId совпадает, то заказ-наряд будет изменен,  
//Если не существует, то будет добавлен.
```json
//принимает
{
  "requestId" : "string", //необязательный параметр (заказ-наряд может быть создан без заявки)
  "clientId" : 0, //УИН клиента
  "vin" : "string", //VIN авто
  "inn" : "string", //ИНН организации
  "documentId" : "string", //Уникальный идентификатор документа
  "comment" : "string", //комментарий к заказ-наряду
  "mileAge" : 0, //пробег
  "materials" : [ //табличная часть (товары или материалы)
    {
      "name" : "string", //наименование товара
      "vendorCode" : "string", //артикул товара
      "manufacturer" : "string", //производитель
      "amount" : 0, //количество
      "price" : 0 //цена
    },
    {
      "name" : "string", //наименование товара
      "vendorCode" : "string", //артикул товара
      "manufacturer" : "string", //производитель
      "amount" : 0, //количество
      "price" : 0 //цена товара (материала)
    },
    ... //Другие товары
  ],
  "works" : [
    {
      "name" : "string", //наименование работы
      "amount" : 0, //количество
      "coefficient" : 0.5, //коэффициент
      "price" : "string" //цена работы
    },
    {
      "name" : "string", //наименование работы
      "amount" : 0, //количество
      "coefficient" : 0.5, //коэффициент
      "price" : "string" //цена работы
    },
    ... //Другие работы
  ]
}
//Отдает созданный/измененный объект (Идентичный объект)
{
  "requestId" : "string", //необязательный параметр (заказ-наряд может быть создан без заявки)
  "clientId" : 0, //УИН клиента
  "vin" : "string", //VIN авто
  "inn" : "string", //ИНН организации
  "documentId" : "string", //Уникальный идентификатор документа
  "comment" : "string", //комментарий к заказ-наряду
  "mileAge" : 0, //пробег
  "materials" : [ //табличная часть (товары или материалы)
    {
      "name" : "string", //наименование товара
      "vendorCode" : "string", //артикул товара
      "manufacturer" : "string", //производитель
      "amount" : 0, //количество
      "price" : 0 //цена
    },
    {
      "name" : "string", //наименование товара
      "vendorCode" : "string", //артикул товара
      "manufacturer" : "string", //производитель
      "amount" : 0, //количество
      "price" : 0 //цена товара (материала)
    },
    ... //Другие товары
  ],
  "works" : [
    {
      "name" : "string", //наименование работы
      "amount" : 0, //количество
      "coefficient" : 0.5, //коэффициент
      "price" : "string" //цена работы
    },
    {
      "name" : "string", //наименование работы
      "amount" : 0, //количество
      "coefficient" : 0.5, //коэффициент
      "price" : "string" //цена работы
    },
    ... //Другие работы
  ]
}
//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

### Удалить заказ-наряд
DELETE (api/1c/repair?documentId={DOCUMENT_ID})
```json
//Удачная операция отдает код 200

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```


## Авторизация для работы с сервисом  
> Прежде чем отправлять запросы сервису, необходимо авторизоваться.  
> Авторизация основана на JWT токенах.  
> Jwt token истекает через 24 часа. RefreshToken истекает через 168 часов.
> Для осуществление запросов процедур необходимо добавить заголовок авторизации (Bearer [token])
> Ниже описаны методы авторизации.

### Авторизация пользователя
POST (/api/account/login)
```json
//На вход принимает
{
  "email": "string",
  "password": "string"
}

//отдает
{
  "userId": 0,
  "userName": "string",
  "token" : "string",
  "refreshToken": "string"
}

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

### Выход пользователя
POST (api/account/logout)
```json
//Удачная операция отдает код 200

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```

### Обновить токены (когда jwt истек, а refresh еще нет, чтобы заново не авторизовываться)
POST (api/account/refresh-tokens)
```json
//На вход принимает
{
  "refreshToken": "string"
}

//отдает
{
  "refreshToken": "string",
  "jwtToken": "string"
}

//В случае ошибки отдает код 400 и результат
{
  "description" : "string"
}
```
